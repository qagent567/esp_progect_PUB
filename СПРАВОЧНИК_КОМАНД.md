# 📚 AgriSwarm: Честный Справочник Команд

*72 команды с реальными примерами и ограничениями*

## 🎮 Интерфейс Командной Строки

**Доступ:** Через Serial Monitor на скорости 115200 baud  
**Возможности:** История команд (↑/↓), автодополнение (TAB), цветной вывод

**⚠️ Честные ограничения:**
- **Отклик:** 50-200мс на команду (не мгновенно)
- **Ошибки ввода:** 70% кода CommandExecutor для обработки неправильных команд
- **Стабильность:** Некоторые команды могут зависнуть при проблемах с сетью
- **Только Serial:** Нет веб-интерфейса или приложения

```bash
AgriSwarm Terminal v0.3.7-bu
Введите 'help' для получения списка команд
> help
```

---

## 🔧 Системные Команды

### `help` - Справочная Система
```bash
help                    # Показать все команды
help system             # Команды категории "system"
help pin                # Команды работы с датчиками
help network           # Команды mesh-сети
help automation        # Команды автоматизации
```

### `status` - Состояние Системы
```bash
status                  # Общий статус всех компонентов
```
**Вывод:**
```
═══════════════════════════════════════════════════════════════
🚀 СТАТУС СИСТЕМЫ AgriSwarm v0.3.7-bu
═══════════════════════════════════════════════════════════════
🔧 Система:        ✅ Работает
💾 Свободная память: 156,432 байт (30.1%)
⏱️ Время работы:    2д 14ч 23м 15с  
🌐 Mesh-сеть:       ✅ Подключено (3 узла)
📡 Node ID:         3456789123
🔌 Датчиков:        5 активных
⚡ Актуаторов:      3 доступных
📝 Правил:          2 включено
⏰ Задач:           1 активная
```

### `memory` - Информация о Памяти
```bash
memory                  # Детальная информация о памяти
```
**Вывод:**
```
💾 СОСТОЯНИЕ ПАМЯТИ ESP32:
├── Общая RAM:           520,192 байт
├── Свободная RAM:       156,432 байт (30.1%)
├── Минимум свободной:   145,220 байт
├── Наибольший блок:     113,664 байт
├── Flash (всего):       4,194,304 байт (4MB)
└── Flash (свободно):    3,534,576 байт (84.3%)
```

### `uptime` - Время Работы
```bash
uptime                  # Сколько система работает без перезагрузки
```

### `reboot` - Перезагрузка
```bash
reboot                  # Перезагрузить ESP32
```

### `clear` - Очистка Экрана
```bash
clear                   # Очистить терминал
```

### `echo` - Вывод Текста
```bash
echo "Привет мир"       # Вывести текст в консоль
echo $memory            # Вывести системную переменную
```

---

## 🌡️ Управление Датчиками и Актуаторами

### `pin_setup` - Настройка Пинов
```bash
# Температурный датчик DHT22
pin_setup temp1 DHT22 4 greenhouse/temp 10 40 30000

# Датчик влажности почвы
pin_setup soil1 ANALOG_IN 36 greenhouse/soil 1000 3500 60000

# Реле управления насосом
pin_setup pump1 RELAY 2 greenhouse/pump

# Цифровой вход (кнопка)
pin_setup button1 DIGITAL_IN 5 control/button

# Цифровой выход (LED)
pin_setup led1 DIGITAL_OUT 23 status/led
```

**Синтаксис:**
```
pin_setup <имя> <тип> <gpio> [топик] [мин] [макс] [интервал_мс]
```

**Поддерживаемые типы:**
- `DHT11` - Датчик температуры/влажности ±2°C
- `DHT22` - Датчик температуры/влажности ±0.5°C  
- `ANALOG_IN` - Аналоговый вход 0-4095
- `DIGITAL_IN` - Цифровой вход 0/1
- `RELAY` - Реле до 10A/220V
- `DIGITAL_OUT` - Цифровой выход 0/1

### `pin_list` - Список Пинов
```bash
pin_list                # Показать все настроенные пины
pin_list sensors        # Только датчики
pin_list actuators      # Только актуаторы
pin_list local          # Только локальные устройства
pin_list remote         # Только удалённые устройства
```

### `pin_tree` - Древовидный Вид
```bash
pin_tree                # Показать пины в виде дерева
```
**Вывод:**
```
📊 ДЕРЕВО ВСЕХ УСТРОЙСТВ:
└── 🏠 Местные устройства (ESP32 ID: 3456789123)
    ├── 🌡️ Датчики (3)
    │   ├── temp1 (DHT22, GPIO 4) → 24.5°C
    │   ├── soil1 (ANALOG, GPIO 36) → 1250 (влажно)
    │   └── motion1 (DIGITAL, GPIO 5) → 0 (нет движения)
    ├── ⚡ Актуаторы (2)
    │   ├── pump1 (RELAY, GPIO 2) → OFF
    │   └── fan1 (RELAY, GPIO 14) → ON
└── 🌐 Удалённые устройства (2 узла)
    ├── 📡 Узел 2345678912
    │   └── valve1 (RELAY) → OFF
    └── 📡 Узел 1234567891
        └── light_sensor (ANALOG) → 2890
```

### `pin_read` - Чтение Значений
```bash
pin_read temp1          # Прочитать температуру
pin_read soil1          # Прочитать влажность почвы
pin_read all            # Прочитать все датчики
```

### `pin_set` - Управление Актуаторами
```bash
pin_set pump1 on        # Включить насос
pin_set pump1 off       # Выключить насос
pin_set fan1 on 30000   # Включить вентилятор на 30 секунд
pin_set led1 toggle     # Переключить LED
```

### `pin_delete` - Удаление Пинов
```bash
pin_delete temp1        # Удалить датчик temp1
pin_delete_all sensors  # Удалить все датчики
pin_delete_all actuators # Удалить все актуаторы
```

### `pin_info` - Информация о Пине
```bash
pin_info temp1          # Подробная информация о датчике
```
**Вывод:**
```
📊 ИНФОРМАЦИЯ О ПИНЕ 'temp1':
├── Тип: DHT22 (температурный датчик)
├── GPIO: 4
├── Топик: greenhouse/temperature
├── Интервал опроса: 30000 мс (30 сек)
├── Диапазон: 10.0°C - 40.0°C
├── Текущее значение: 24.5°C
├── Последнее обновление: 2 сек назад
├── Статус: ✅ Активен
└── Счетчик ошибок: 0
```

---

## 🌐 Mesh-Сеть

### `mesh_nodes` - Узлы Сети
```bash
mesh_nodes              # Показать все узлы в mesh-сети
```
**Вывод:**
```
🌐 УЗЛЫ MESH-СЕТИ (3 активных):
┌─────────────┬─────────────────┬─────────────┬──────────┬─────────────┐
│ Node ID     │ Имя             │ Статус      │ RSSI     │ Последняя связь │
├─────────────┼─────────────────┼─────────────┼──────────┼─────────────┤
│ 3456789123  │ Главный         │ ✅ Локальный │ -       │ -           │
│ 2345678912  │ Полив           │ ✅ Онлайн    │ -45 dBm │ 2 сек назад │
│ 1234567891  │ Освещение       │ ✅ Онлайн    │ -52 dBm │ 1 сек назад │
└─────────────┴─────────────────┴─────────────┴──────────┴─────────────┘
```

### `ping_test` - Тест Связи
```bash
ping_test               # Ping всех узлов
ping_test 2345678912    # Ping конкретного узла
```
**Вывод:**
```
📡 ТЕСТ СВЯЗИ С УЗЛАМИ:
├── Узел 2345678912: 23ms ✅
├── Узел 1234567891: 34ms ✅
└── Среднее время отклика: 28.5ms
```

### `network_status` - Статус Сети
```bash
network_status          # Детальная информация о mesh-сети
```

### `topics_list` - Топики Сети
```bash
topics_list             # Показать все топики
topics_list tree        # В виде дерева
topics_list sensors     # Только датчики
topics_list actuators   # Только актуаторы
```

### `mesh_optimize` - Оптимизация Сети
```bash
mesh_optimize speed     # Оптимизация для скорости
mesh_optimize stability # Оптимизация для стабильности
mesh_optimize balance   # Баланс скорости и стабильности
mesh_optimize auto      # Автоматическая оптимизация
mesh_optimize status    # Текущие настройки оптимизации
```

---

## 🤖 Автоматизация

### `rule_add` - Создание Правила
```bash
# Простое правило
rule_add auto_water soil1 < 1500 pump1 on

# Правило с длительностью
rule_add auto_water soil1 < 1500 pump1 on 5000

# Сложное правило
rule_add cooling temp1 > 28 fan1 on
```

**Синтаксис:**
```
rule_add <id> <датчик> <условие> <значение> <актуатор> <команда> [длительность_мс]
```

**Поддерживаемые условия:**
- `>` - больше
- `<` - меньше  
- `==` - равно
- `!=` - не равно
- `>=` - больше или равно
- `<=` - меньше или равно

### `rule_list` - Список Правил
```bash
rule_list               # Показать все правила
rule_list enabled       # Только включённые
rule_list disabled      # Только выключенные
```
**Вывод:**
```
📝 ПРАВИЛА АВТОМАТИЗАЦИИ (2 шт.):
┌─────────────┬─────────────────────┬─────────┬─────────────┬─────────────┐
│ ID          │ Условие → Действие  │ Статус  │ Срабатывания│ Последнее   │
├─────────────┼─────────────────────┼─────────┼─────────────┼─────────────┤
│ auto_water  │ soil1 < 1500 →     │ ✅ Вкл  │ 15 раз      │ 2 мин назад │
│             │ pump1 ON (5 сек)    │         │             │             │
├─────────────┼─────────────────────┼─────────┼─────────────┼─────────────┤
│ cooling     │ temp1 > 28 →       │ ✅ Вкл  │ 3 раза      │ 1 час назад │
│             │ fan1 ON             │         │             │             │
└─────────────┴─────────────────────┴─────────┴─────────────┴─────────────┘
```

### `rule_enable` - Управление Правилами
```bash
rule_enable auto_water on    # Включить правило
rule_enable cooling off      # Выключить правило
```

### `rule_delete` - Удаление Правил
```bash
rule_delete auto_water       # Удалить правило
rule_delete_all             # Удалить все правила (осторожно!)
```

### `rule_info` - Информация о Правиле
```bash
rule_info auto_water        # Подробности о правиле
```

### `rule_wizard` - Мастер Создания Правил
```bash
rule_wizard                 # Пошаговое создание правила
```

---

## ⏰ Планировщик Задач

### `task_setup` - Создание Задачи
```bash
task_setup                  # Мастер создания задачи
```

### `task_list` - Список Задач
```bash
task_list                   # Показать все задачи
task_list active           # Только активные
```

### `task_enable` - Управление Задачами
```bash
task_enable task1 on        # Включить задачу
task_enable task1 off       # Выключить задачу
```

### `task_delete` - Удаление Задач
```bash
task_delete task1           # Удалить задачу
```

---

## 📝 Система Логирования

### `loglevel` - Уровень Детализации
```bash
loglevel 0                  # Без логов
loglevel 1                  # Только ошибки
loglevel 2                  # Информация
loglevel 3                  # Предупреждения
loglevel 4                  # Отладка (максимум)
```

### `messages` - Просмотр Логов
```bash
messages                    # Последние 10 сообщений
messages 50                 # Последние 50 сообщений
messages all                # Все сообщения в буфере
messages PinManager         # Только от компонента PinManager
```

### `colors` - Управление Цветами
```bash
colors on                   # Включить цветной вывод
colors off                  # Отключить цветной вывод
```

### `debug` - Отладочные Сообщения ESP32
```bash
debug on                    # Включить системные логи ESP32
debug off                   # Отключить системные логи ESP32
```

### `wifi_logs` - Логи WiFi
```bash
wifi_logs on                # Включить логи WiFi
wifi_logs off               # Отключить логи WiFi
```

---

## 📊 Мониторинг и Диагностика

### `health_check` - Комплексная Диагностика
```bash
health_check                # Проверить всё
health_check memory         # Только память
health_check sensors        # Только датчики
health_check network        # Только сеть
```
**Вывод:**
```
🏥 КОМПЛЕКСНАЯ ПРОВЕРКА ЗДОРОВЬЯ СИСТЕМЫ:
╔═══════════════════════════════════════════════════════════════╗
║                    РЕЗУЛЬТАТЫ ДИАГНОСТИКИ                     ║
╠═══════════════════════════════════════════════════════════════╣
║ 💾 Память:           ✅ ХОРОШО (30.1% свободно)              ║
║ 🌐 Mesh-сеть:        ✅ ОТЛИЧНО (3 узла, ping 28ms)         ║
║ 🌡️ Датчики:          ✅ ХОРОШО (5/5 активны)               ║
║ ⚡ Актуаторы:        ✅ ОТЛИЧНО (3/3 доступны)             ║
║ 📝 Правила:          ✅ ХОРОШО (2 активны)                  ║
║ ⏰ Задачи:           ✅ ХОРОШО (1 активна)                  ║
║ 🔧 Система:          ✅ ОТЛИЧНО (стабильна 2д 14ч)         ║
╚═══════════════════════════════════════════════════════════════╝
🎯 ОБЩАЯ ОЦЕНКА: ✅ СИСТЕМА РАБОТАЕТ ОТЛИЧНО
```

### `sensor_diagnose` - Диагностика Датчиков
```bash
sensor_diagnose             # Диагностика всех датчиков
sensor_diagnose temp1       # Диагностика конкретного датчика
```

### `sensor_status` - Статус Датчиков
```bash
sensor_status               # Краткий статус всех датчиков
sensor_status detailed      # Подробный статус
```

### `stability` - Статистика Стабильности
```bash
stability                   # Показать статистику стабильности системы
```

### `fs_info` - Информация о Файловой Системе
```bash
fs_info                     # Информация о LittleFS
```
**Вывод:**
```
💾 ФАЙЛОВАЯ СИСТЕМА LittleFS:
├── Общий размер:     1,048,576 байт (1.0 MB)
├── Использовано:     245,760 байт (23.4%)
├── Свободно:         802,816 байт (76.6%)
├── Файлов:           12
└── Директорий:       3

📁 ОСНОВНЫЕ ФАЙЛЫ:
├── /config.json (1,234 байт)
├── /rules.json (2,456 байт)
├── /pins/ (директория с 5 файлами)
└── /tasks.json (890 байт)
```

---

## 🧙‍♂️ Интерактивные Мастера

### `wizard` - Мастера Настройки
```bash
wizard                      # Показать доступные мастера
wizard first_run           # Мастер первичной настройки
wizard sensor_setup        # Мастер настройки датчиков
wizard automation_setup    # Мастер создания правил
```

### `network_wizard` - Мастер Сети
```bash
network_wizard              # Пошаговая настройка mesh-сети
```

### `examples` - Примеры Команд
```bash
examples                    # Показать примеры основных команд
examples pin_setup         # Примеры настройки датчиков
examples rules             # Примеры правил автоматизации
```

---

## 🔧 Системное Управление

### `config_show` - Просмотр Конфигурации
```bash
config_show                 # Показать основные настройки
config_show mesh           # Настройки mesh-сети
config_show wifi           # Настройки WiFi
```

### `config_backup` - Резервное Копирование
```bash
config_backup              # Создать backup всех настроек
config_restore             # Восстановить из backup
```

### `config_reset` - Сброс Настроек
```bash
config_reset pins          # Сбросить настройки пинов
config_reset rules         # Сбросить правила
config_reset all           # Полный сброс (осторожно!)
```

---

## 💡 Полезные Команды

### `sysinfo` - Системная Информация
```bash
sysinfo                     # Детальная информация о системе
```

### `quick_status` - Быстрый Статус
```bash
quick_status                # Краткая сводка состояния
```

### `subscriptions_health` - Здоровье Подписок
```bash
subscriptions_health        # Проверить состояние подписок на топики
```

### `send_heartbeat` - Отправка Heartbeat
```bash
send_heartbeat             # Принудительно отправить heartbeat в сеть
```

---

## 🎯 Советы по Использованию

### 🔍 Поиск Команд
```bash
help | grep pin            # Найти все команды с "pin"
help | grep mesh           # Найти все mesh команды
```

### ⌨️ Горячие Клавиши
- **↑/↓** - Навигация по истории команд
- **TAB** - Автодополнение имён команд и параметров
- **Ctrl+C** - Прервать выполнение команды

### 📋 Последовательности Команд
```bash
# Быстрая настройка системы
wizard first_run
pin_setup temp1 DHT22 4
pin_setup pump1 RELAY 2
rule_add auto_water temp1 > 30 pump1 on 5000
status

# Диагностика проблем
health_check
sensor_diagnose
mesh_nodes
ping_test
messages 20
```

### 🎨 Цветовая Схема
- **🟢 Зелёный** - Успешные операции, нормальные значения
- **🟡 Жёлтый** - Предупреждения, пограничные значения
- **🔴 Красный** - Ошибки, критические состояния
- **🔵 Синий** - Информационные сообщения
- **⚪ Белый** - Нейтральные данные

---

**📚 Справка по Синтаксису:**
- `<обязательный_параметр>` - должен быть указан
- `[необязательный_параметр]` - можно не указывать
- `параметр1|параметр2` - выберите один из вариантов
- `...` - можно указать несколько значений

**💡 Совет:** Используйте `help <команда>` для получения подробной справки по любой команде!


